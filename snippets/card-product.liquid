{% comment %}
    Renders a product card

    Accepts:
    - card_product: {Object} Product Liquid object (optional)
    - media_aspect_ratio: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
    - show_vendor: {Boolean} Show the product vendor. Default: false
    - show_rating: {Boolean} Show the product rating. Default: false
    - loading: {Boolean} Image should be lazy loaded. Default: lazy (optional)
    - section_id: {String} The ID of the section that contains this card.
    - disable_badges: {Boolean} Don't show labels and badges
    - list_name: {String} The title of collection,
    - collection: {Object} Collection Liquid object (optional),
    - class_slide: {String} The class of slider,
    - index: {Number} The index of the product card in the collection,
    - product_complementary: Classes are used for product complementary
    - disable_quickview: {Boolean} Show quick view button. Default: true (optional)
    - block_id: {String} The ID of the block that contains this card.
    - product_metafield: {String} The handle of the metafield that contains a featured image for the product
    Usage:
    {% render 'card-product', show_vendor: section.settings.show_vendor %}
{% endcomment %}
{%- liquid
  if column_mobile == blank
    assign column_mobile = 1
  endif 
  if media_aspect_ratio == blank
    assign media_aspect_ratio = settings.product_image_ratio
  endif 
  assign ratio = 1 
  case media_aspect_ratio
    when "portrait"
      assign ratio = 1.5
    when "landscape"
      assign ratio = 0.75
    when "wide"
      assign ratio = 0.5625
    when "3/4"
      assign ratio = 1.33
  endcase
  assign content_alignment = settings.info_alignment_card_product
  if info_alignment
    assign content_alignment = info_alignment
  endif 
  assign show_rounded_image = false
  if settings.edges_type == 'rounded_corners'
    assign show_rounded_image = true
  endif
  if settings.lang_direction contains request.locale.iso_code
    assign is_rtl = true
  else
    assign is_rtl = false
  endif

  assign can_show_preorder = false
  if settings.preorder_show == 'yes' or settings.preorder_show == 'on_backordered' and card_product.selected_or_first_available_variant.inventory_policy == 'continue' and card_product.selected_or_first_available_variant.inventory_quantity < 1 and card_product.selected_or_first_available_variant.inventory_management != nil
    if settings.applied_products_preorder == blank and settings.applied_collections_preorder == blank
      assign can_show_preorder = true
    else 
      assign list_product = ''
      for prod in settings.applied_products_preorder
        assign list_product = list_product | append: ';' | append: prod.id
      endfor 
      for collec in settings.applied_collections_preorder
        for prod in collec.products 
          assign list_product = list_product | append: ';' | append: prod.id
        endfor
      endfor
      if list_product contains card_product.id 
        assign can_show_preorder = true
      endif
    endif
  endif 

  assign message_preorder = 'general.preorder.message_preorder' | t
  if settings.message_preorder != blank
    assign message_preorder = settings.message_preorder
  endif 

  assign disable_cart_edt = false
  if card_product.gift_card? or can_show_preorder and settings.hide_when_pre_order
    assign disable_cart_edt = true
  endif

  assign count_media = card_product.media | size
  if settings.number_of_additional_images < count_media
    assign count_media = settings.number_of_additional_images
  endif
  unless disable_badges
    assign current_date = 'now' | date: '%s' 
    assign product_created_at = card_product.created_at | date: "%s"
    assign product_published_at = card_product.published_at | date: "%s"
    assign difference_in_seconds_created = current_date | minus: product_created_at
    assign difference_in_days_created = difference_in_seconds_created | times: 1.0 | divided_by: 86400 | round: 2
    assign difference_in_seconds_published = current_date | minus: product_published_at
    assign difference_in_days_published = difference_in_seconds_published | times: 1.0 | divided_by: 86400 | round: 2
  endunless

  assign shipping_insurance = false
  if settings.enable_shipping_insurance and settings.product_shipping_insurance != blank and settings.product_shipping_insurance.selected_or_first_available_variant.available
    assign shipping_insurance = settings.product_shipping_insurance.selected_or_first_available_variant.id
    for item in cart.items
      if item.product.selected_or_first_available_variant.id == settings.product_shipping_insurance.selected_or_first_available_variant.id
        assign shipping_insurance = false
      endif
    endfor
  endif
-%}
{%- capture data_for_customer_event -%}
  {
    "product": {
      "title": "{{ card_product.title | escape }}",
      "listName": "{{ collection.title | default: list_name | escape }}",
      "sku": "{{ card_product.id }}",
      "currencyCode": "{{ cart.currency.iso_code }}",
      "price": {{ card_product.price }},
      "vendor": "{{ card_product.vendor | escape }}"
    }
  }
{%- endcapture %}
{%- unless disable_badges -%}
  {%- capture data_for_label -%}
    [
    {%- for variant in card_product.variants -%}
      {%- liquid
        assign list_metafield_label = ''
        if settings.metafield_label != blank
          assign metafield_labels = settings.metafield_label | newline_to_br | strip_newlines | split: '<br />'
          for metafield_label in metafield_labels
            assign mtf_key = metafield_label | remove: ' ' | split: '.'
            assign mtf_value = variant.metafields[mtf_key.first][mtf_key.last]
            if mtf_value == blank or mtf_value.type != 'single_line_text_field'
              assign mtf_value = card_product.metafields[mtf_key.first][mtf_key.last]
              if mtf_value != blank and mtf_value.type != 'single_line_text_field'
                assign mtf_value = ''
              endif
            endif
            if forloop.last
              assign list_metafield_label = list_metafield_label | append: '"' | append: metafield_label | append: '":"' | append: mtf_value | append: '"'
            else
              assign list_metafield_label = list_metafield_label | append: '"' | append: metafield_label | append: '":"' | append: mtf_value | append: '",'
            endif
          endfor
        endif    
      -%}
      {
        "variant_id": {{ variant.id | default: card_product.id }},
        "product_id": {{ card_product.id }},
        "available": {{ card_product.available }},
        "title": "{{ card_product.title | escape }}",
        "compare_at_price": {{ variant.compare_at_price | default: 0 }},
        "price": {{ variant.price }},
        "price_with_currency": "{% if settings.currency_code_enable %}{{ variant.price | money_with_currency | escape }}{% else %}{{ variant.price | money | escape }}{% endif %}",
        "sale_amount": "{{ variant.compare_at_price | minus: variant.price | money | strip_html }}",
        "collections": "||{{ card_product.collections | map: 'id' | join: '||' }}||",
        "inventory_management": "{{ variant.inventory_management }}",
        "qty": {{ variant.inventory_quantity | default: -1 }},
        "container": "card",
        "can_show_preorder": {{ can_show_preorder }},
        "diff_day_create": {{ difference_in_days_created }},
        "diff_day_publish": {{ difference_in_days_published }}
        {% if settings.metafield_label != blank %}
          ,"metafield_label": { 
            {{ list_metafield_label }}
          }
        {% endif %}
      }{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
    ]
  {%- endcapture %}
{%- endunless -%}
<div 
  {% if settings.swatches_type == 'both_text_and_color' or settings.swatches_type == 'color' %}
    x-data="xProductCard('{{ section_id }}-{{ product_card_id }}', '{{ card_product.url | within: collection | split: "?" | first }}', '{{ card_product.id }}')"  
  {% else %}
    x-data="{ showOptions: false, options: [] }"
  {% endif %}
  class="card-product overflow-hidden card md:list-layout:flex relative pb-4 md:pb-5
    {%- if image_ratio_setting == 'fit_grid_layout' %} flex flex-col md:flex md:flex-col
      {%- else -%}
      {%- if mediaGallery %} flex flex-col md:block{% endif -%}
    {%- endif -%}
    {%- if is_rtl %} rtl{% endif -%}
    {%- if request.params.size > 0 %} cos pram{% endif -%}
    {%- if class_slide %} {{ class_slide }}{% endif -%}
    {%- unless swiper_on_mobile %} h-full{% endunless -%}
    {%- if extend_height %} flex flex-col{% endif -%}
    {%- unless product_complementary %}{% if show_rounded_image %} rounded-[10px]{% endif %}{% endunless -%}" 
  x-slide-index="{{ index | minus: 1 }}"
>
  <div 
    class="md:list-layout:w-2/5 md:list-layout:lg:w-1/4 relative disable-effect
      {%- if is_rtl %} md:list-layout:pl-7{% else %} md:list-layout:pr-7{% endif -%}
      {%- if product_complementary %} flex{% endif -%}
      {%- if extend_height %} flex flex-col{% endif -%}
      {%- if image_ratio_setting == 'fit_grid_layout' %} flex flex-col grow md:flex md:flex-col md:grow {% else %}{% if mediaGallery %} flex flex-col grow md:block{% endif %}{% endif -%}
    "
  >
    {% style %}
      {% if mediaGallery %}
        .full-unstyled-link.link-product-variant.card-product-title-text-{{ block_id }} {
          font-size: {{ settings.title_size_card | times: text_size | times: 0.01 | times: 0.01 | times: 0.9 }}rem;
        }
        .x-card-price.card-product-price-text-{{ block_id }} {
          font-size: {{ settings.price_size_card | times: text_size | times: 0.01 | times: 0.01 | times: 0.9 }}rem;
        }
        .card-product-vendor-text-{{ block_id }} {
          font-size: {{ settings.title_size_card | times: text_size | times: 0.9 | times: 0.01 | times: 0.007875 }}rem;
        }
        @media (min-width: 768px) {
          .full-unstyled-link.link-product-variant.card-product-title-text-{{ block_id }} {
            font-size: {{ settings.title_size_card | times: text_size | times: 0.01 | times: 0.01 }}rem;
          }
          .x-card-price.card-product-price-text-{{ block_id }} {
            font-size: {{ settings.price_size_card | times: text_size | times: 0.01 | times: 0.01 }}rem;
          }
          .card-product-vendor-text-{{ block_id }} {
            font-size: {{ settings.title_size_card | times: text_size | times: 0.9 | times: 0.01 | times: 0.00875 }}rem;
          }
        }
      {% endif %}
    {% endstyle %}
    {% if product_complementary %}
      <div class="w-1/6">
    {% endif %}
    {% style %}
      {% if mediaGallery %}
        .media-gallery-{{ block_id }} {
          {% if media_aspect_ratio == "natural" and card_product.featured_media and card_product.featured_media.media_type != "model" %}
            {% if image_ratio_setting != 'fit_grid_layout' %}
              height: 0;
              padding-bottom: {{ 1 | divided_by: card_product.featured_media.aspect_ratio | times: 100 }}%;
            {% endif %}
          {% endif %}
        }
      {% endif %}
    {% endstyle %}
    <a 
      {% unless loading == 'eager' %}
        x-intersect.once.margin.-20px.0px.-20px.0px="$el.querySelector('.animate_transition_card__image')?.classList.add('active', 'lazy_active')"
      {% endunless %}
      href="{{ card_product.url | within: collection }}"
      {% unless disable_badges %} 
        x-data="{ lastWindowWidth: 0 }"
        x-intersect.once.margin.200px='$nextTick(() => { $store.xBadges && $store.xBadges.load($el, () => {}, null, true); })'
        x-labels-data="{{ data_for_label | escape }}"
      {% endunless %} 
      aria-label="{{ card_product.title }}"
      id="{{ card_product.id }}-{{ section.id }}"
      class="ltr group link-product-variant overflow-hidden block relative z-[15] cursor-pointer before:h-0 before:block
      {%- if collage %} grow{% else %} no-collage{% endif -%}
      {%- if show_rounded_image %} rounded-[10px]{% endif -%}
      {%- if image_ratio_setting == 'fit_grid_layout' %} md:h-full h-full pb-0{% else -%}
      {%- if mediaGallery %} h-full pb-0 md:h-auto media-gallery-{{ block_id }}{% endif -%}
      {%- if media_aspect_ratio == "natural" %}{% if card_product.featured_media.media_type == "model" or card_product.featured_media == blank %} pb-[100%]{% endif %}{% else %} pb-[{{ ratio | times: 100 | round }}%]{% endif -%}
      {%- endif -%}
      {%- if settings.product_image_type == "slide_img" and count_media > 1 and class_slide != 'recommendations' and settings.show_arrow == false %} disable-label-hover{% endif -%}"
      {%- unless mediaGallery %}{% if media_aspect_ratio == "natural" and card_product.featured_media and card_product.featured_media.media_type != "model" %} style="height: 0; padding-bottom: {{ 1 | divided_by: card_product.featured_media.aspect_ratio | times: 100 }}%;"{% endif %}{% endunless -%}>
      <div x-data="xDoubleTouch('{{ card_product.url | within: collection }}')" class="w-full h-full z-0 overflow-hidden absolute top-0 left-0{% if animation_loading and loading != 'eager' %} animate_transition_card__image{% endif %}">
        <div
          id="x-slideshow-card-product-{{ section_id }}-{{ product_card_id }}-{{ index | minus: 1 }}"
          class="block h-full{% if settings.product_image_type == "slide_img" and count_media > 1 and class_slide != 'recommendations' %} visible{% unless media_aspect_ratio == "natural" %} card-product-img{% endunless %} w-full top-0 left-0 absolute x-splide disable-effect-hover splide cursor-grab group{% endif %}" 
          @click='$store.xCustomerEvent.fire("product_selected", $el)'
          x-customer-event-data="{{ data_for_customer_event | escape }}"
          {% if settings.product_image_type == "slide_img" and count_media > 1 and class_slide != 'recommendations' %}
            x-cloak
            x-intersect.once.margin.200px='$store.xSplide.load($el, {
              "drag": false,
              "pauseOnFocus": false,
              "pauseOnHover": false,
              "perMove": 1,
              "perPage": 1,
              "focus": "center",
              "type": "{% if settings.product_card_effect_reveal_image == 'slide' and settings.show_arrow %}slide{% else %}fade{% endif %}",
              "events": [
                {
                  "event": "ready",
                  "callback": () => {
                    window.requestAnimationFrame(() => {
                      const nodeList = $el.querySelectorAll(".splide__pagination li");
                      const reversed = Array.from(nodeList).reverse();

                      reversed.forEach((el, index) => {
                        if (index > {{ count_media }} - 1) {
                          el.remove();
                        }
                      });
                    })
                  }
                }
              ],
              {% unless settings.show_arrow -%}
                "cardHover": "image-product-{{ section_id }}-{{ product_card_id }}-{{ index | minus: 1 }}",
                "maxSlide": "{{ count_media }}",
                "arrows": false,
                "classes": {
                  "pagination": "splide__pagination pagination-card hidden grid-cols-{{ count_media }} pointer-events-none absolute gap-1 top-5 pl-5 pr-5 w-full z-0",
                  "page": "button none_border btn-pagination flex items-center w-full h-1"
                }
              {% else %}
                {% if settings.change_slides_speed > 0 %}
                  "rewind": true,
                  "autoplay": true,
                  "speed": {% if settings.product_card_effect_reveal_image == 'fade' %}{{ settings.change_slides_speed | times: 1000 }}{% else %}1000{% endif %},
                  "interval": {{ settings.change_slides_speed | times: 1000 }},
                  "updateOnMove": "true",
                  "playOnHover": true,
                {% endif %}
                "pagination": false
              {%- endunless %}
            })'
          {%- endif -%}
        >
          {%- if settings.product_image_type != 'none' -%}
            <div 
              class="absolute inset-0 z-10 pointer-events-auto dbtap-overlay"
              @touchstart="onTouchStart($event)"
              @touchend.prevent="onTouchEnd($el.closest('.x-splide'){% if settings.product_image_type == "slide_img" and count_media > 1 and class_slide != 'recommendations' %}, true{% endif %})"
              @touchmove="onTouchMove($event)"
            ></div>
          {%- endif -%}
          {% if settings.product_image_type == "slide_img" and count_media > 1 and class_slide != 'recommendations' %}
            <div 
              id="image-product-{{ section_id }}-{{ product_card_id }}-{{ index | minus: 1 }}"
              class="splide__track overflow-hidden max-h-full h-full w-full"
            >
            <div class="w-full h-full splide__list">
          {%- endif -%}
          {%- if card_product.featured_media -%}
            {%- capture sizes -%}
              {%- if collage or mediaGallery -%}
                {%- if full_width -%}
                  (min-width: 768px) {{ columns_desktop | times: 100 | divided_by: max_columns }}vw, {{ columns_mobile | times: 100 | divided_by: min_columns_mobile }}vw
                {%- else -%}
                  (min-width: {{ settings.page_width }}px) {{ settings.page_width | times: columns_desktop | divided_by: max_columns }}px, {{ columns_mobile | times: 100 | divided_by: min_columns_mobile }}vw
                {%- endif -%}
              {%- else -%}
                (min-width: {{ settings.page_width }}px) {% if enable_desktop_slider %}{{ settings.page_width | plus: 100 | divided_by: columns_desktop }}px{% else %}calc(100vw / {{ columns_desktop }}){% endif %}, (min-width: 1024px) calc((100vw) / {{ columns_desktop }}), (min-width: 768px) calc((100vw) / 2), calc(100vw /{{ column_mobile }})
              {%- endif -%}
            {%- endcapture -%}
            {%- capture onload -%}
              this.closest(".skeleton-image")?.classList.remove("animate-Xpulse", "skeleton-image");
            {%- endcapture -%}
            {% liquid
              if card_product.featured_media
                assign product_featured_image = card_product.featured_media
                if product_metafield != blank and card_product.metafields.custom[product_metafield]
                  assign product_featured_image = card_product.metafields.custom[product_metafield]
                endif
              endif
            %}
            {%- if loading == 'eager' -%}
              <div class="hidden">
                {% assign featured_media_alt = product_featured_image.alt | split: "#" | first | escape %}
                {{ product_featured_image | image_url: width: 1500 | image_tag: widths: '375, 450, 750, 900, 1100, 1500', preload: true, loading: 'lazy', onload: onload, sizes: sizes, alt: featured_media_alt }}
              </div>
            {%- endif -%}
            <div class="w-full z-0
              {%- if image_ratio_setting == 'fit_grid_layout' %} md:h-full md:min-h-full h-full min-h-full
                {%- else -%}
                {%- if media_aspect_ratio != "natural" %} h-full min-h-full{% endif -%}
              {%- endif -%} 
              {%- if settings.product_image_type != "slide_img" or count_media <= 1 or class_slide == 'recommendations' %} top-0 left-0 absolute{% else %} overflow-hidden splide__slide x-splide-slide max-h-full{% endif -%}"
            >
              {% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
              <picture>
                <img
                  srcset="{{ product_featured_image | image_url: width: 450 }} 450w,
                  {{ product_featured_image | image_url: width: 750 }} 750w,
                  {{ product_featured_image | image_url: width: 900 }} 900w,
                  {{ product_featured_image | image_url: width: 1100 }} 1100w,
                  {{ product_featured_image | image_url: width: 1500 }} 1500w
                  {%- if product_featured_image.width %},{{ product_featured_image | image_url }} {{ product_featured_image.width }}w{% endif %}" 
                  src="{{ product_featured_image | image_url: width: 1500 }}"
                  sizes="{{ sizes }}"
                  alt="{{ product_featured_image.alt | split: "#" | first | escape }}"
                  :class="showSecond ? 'first-img' : ''"
                  class="w-full {% unless product_metafield != blank and card_product.metafields.custom[product_metafield] %} preview-img{% endunless %} motion-reduce aspect-{{ media_aspect_ratio }} relative animate-Xpulse skeleton-image object-cover
                    {%- if image_ratio_setting == 'fit_grid_layout' %} md:h-full md:min-h-full h-full min-h-full
                      {%- else -%} 
                      {%- if media_aspect_ratio != "natural" %} h-full min-h-full{% endif -%}
                    {%- endif -%}
                    {%- if card_product.media[1] != nil and settings.product_image_type == 'hover_to_reveal_second_image' and settings.product_card_effect_reveal_image != 'slide' %} image-first-hover lg:group-hover:opacity-0
                      {%- elsif card_product.media[1] != nil and settings.product_image_type == 'hover_to_reveal_second_image' and settings.product_card_effect_reveal_image == 'slide' %} image-first-slide-anm lg:group-hover:opacity-0 transition-opacity duration-500
                      {%- elsif settings.product_image_type != 'slide_img' %} image-hover
                    {%- endif -%}
                    {%- if animation_loading and loading != 'eager' %} animate_transition_image{% endif -%}
                  "
                  loading="{{ loading | default: 'lazy' }}"
                  width="{% if product_metafield != blank and card_product.metafields.custom[product_metafield] %}{{ product_featured_image.width }}{% else %}{{ product_featured_image.preview_image.width }}{% endif %}"
                  height="{% if product_metafield != blank and card_product.metafields.custom[product_metafield] %}{{ product_featured_image.height }}{% else %}{{ product_featured_image.preview_image.height }}{% endif %}"
                  onload="{% if animation_loading and loading != 'eager' %}this?.classList.add('active');{% endif -%}
                    this.closest('.skeleton-image')?.classList.remove('animate-Xpulse', 'skeleton-image');
                    setTimeout(() => { this.closest('.animate_transition_card__image')?.classList.add('lazy_active', 'active'); }, 250);"
                />
              </picture>
              {% comment %}theme-check-enable ImgLazyLoading{% endcomment %}
            </div>
            {%- if card_product.media[1] != nil -%}
              {%- if settings.product_image_type == "hover_to_reveal_second_image" -%}
                <div class="w-full h-full top-0 left-0 absolute lg:block">
                  <picture>
                    <img
                      srcset="{{ card_product.media[1] | image_url: width: 450 }} 450w,
                        {{ card_product.media[1] | image_url: width: 750 }} 750w,
                        {{ card_product.media[1] | image_url: width: 900 }} 900w,
                        {{ card_product.media[1] | image_url: width: 1100 }} 1100w,
                        {{ card_product.media[1] | image_url: width: 1500 }} 1500w
                        {%- if card_product.media[1].width %},{{ card_product.media[1] | image_url }} {{ card_product.media[1].width }}w{% endif %}"
                      src="{{ card_product.media[1] | image_url: width: 1500 }}"
                      sizes="{{ sizes }}"
                      alt="{{ card_product.media[1].alt | split: "#" | first | escape }}"
                      :class="showSecond ? 'second-img' : ''"
                      class="motion-reduce min-w-full h-full object-cover group-hover:cursor-pointer
                        {%- if media_aspect_ratio == "natural" %} aspect-auto{% endif -%}
                        {%- if settings.product_image_type == 'slide_img' -%} animate-Xpulse skeleton-image{% endif -%}
                        {%- if settings.product_card_effect_reveal_image == 'fade' %} image-second-hover opacity-0 lg:group-hover:opacity-100{% endif -%}
                        {%- if settings.product_card_effect_reveal_image == 'slide' %} image-first-hover-slide-anm absolute top-0 -right-[101%]{% endif -%}
                      "
                      loading="lazy"
                      width="{{ card_product.media[1].width }}"
                      height="{{ card_product.media[1].height }}"
                      onload="this.closest('.skeleton-image')?.classList.remove('animate-Xpulse', 'skeleton-image');
                        setTimeout(() => { this.closest('.animate_transition_card__image')?.classList.add('lazy_active', 'active'); }, 250);"
                    />
                  </picture>
                </div>
              {%- elsif settings.product_image_type == "slide_img" and count_media > 1 and class_slide != 'recommendations' -%}
                {% for media in card_product.media %}
                  {%- if forloop.index > 1 -%}
                    <div 
                      index="{{ forloop.index0 }}" 
                      media="{{ media | image_url }}"
                      class="media-slide w-full splide__slide x-splide-slide z-0 transition ease-out duration-300
                        {%- if media_aspect_ratio != "natural" %} h-full min-h-full{% endif -%}
                        {%- if animation_loading and settings.show_arrow == false %} opacity-0{% endif -%}
                      "
                    >
                      <picture>
                        <img
                          srcset="{{ media | image_url: width: 450 }} 450w,
                            {{ media | image_url: width: 750 }} 750w,
                            {{ media | image_url: width: 900 }} 900w,
                            {{ media | image_url: width: 1100 }} 1100w,
                            {{ media | image_url: width: 1500 }} 1500w
                            {%- if media.width %},{{ media | image_url }} {{ media.width }}w{% endif %}"
                          src="{{ media | image_url: width: 1500 }}"
                          sizes="{{ sizes }}"
                          alt="{{ media.alt | split: "#" | first | escape }}"
                          class="w-full motion-reduce{% if media_aspect_ratio == "natural" %} aspect-auto{% else %} h-full min-h-full{% endif %} object-cover animate-Xpulse skeleton-image"
                          loading="lazy"
                          onload="this.closest('.skeleton-image')?.classList.remove('animate-Xpulse', 'skeleton-image');
                            setTimeout(() => { this.closest('.animate_transition_card__image')?.classList.add('lazy_active', 'active'); }, 250);"
                          width="{{ media.width }}"
                          height="{{ media.height }}"
                        />
                      </picture>
                    </div>
                  {% endif %}
                  {% liquid 
                    if forloop.index == count_media
                      break 
                    endif
                  %}
                {% endfor %} 
              {%- endif -%}
            {%- endif -%}
          {%- else -%} 
            <div 
              class='bg-[#c9c9c9] flex justify-center{% unless media_aspect_ratio == "natural" %} absolute{% endunless %} top-0 left-0 w-full h-full items-center'
              x-init="$el.closest('.skeleton-image')?.classList.remove('animate-Xpulse', 'skeleton-image')"
            >
              {%- render 'icon-placeholder', icon: 'icon-product', class: 'w-full h-full' %}
            </div>
          {%- endif -%}
          {% if settings.product_image_type == "slide_img" and count_media > 1 and class_slide != 'recommendations' %}
              </div>
            </div>
            {%- if settings.show_arrow -%}
              <div class="splide__arrows lg:inline-flex hidden">
                <button @click.prevent="prev = true" class="text-[rgba(var(--colors-transition-arrows))] splide__arrow splide__arrow--prev disable-effect-hover hidden group-hover:lg:block absolute none_border z-30 {% if settings.icon_options == "modern" %}w-[60px]{% else %}w-11{% endif %} h-1/2 rounded-full after:text-[20px] pl-4.5 pr-4 top-1/2 -translate-y-1/2 duration-100 opacity-60 hover:opacity-100 disabled:opacity-40 disabled:cursor-not-allowed left-0 rotate-180" aria-label="previous slide">
                  {% render 'icon-alls', icon: 'icon-transition-arrow' %}
                </button>
                <button @click.prevent="next = true" class="text-[rgba(var(--colors-transition-arrows))] splide__arrow splide__arrow--next disable-effect-hover hidden group-hover:lg:block absolute none_border z-30 {% if settings.icon_options == "modern" %}w-[60px]{% else %}w-11{% endif %} h-1/2 rounded-full after:text-[20px] pl-4.5 pr-4 top-1/2 -translate-y-1/2 duration-100 opacity-60 hover:opacity-100 disabled:opacity-40 disabled:cursor-not-allowed right-0" aria-label="next slide">
                  {% render 'icon-alls', icon: 'icon-transition-arrow' %}
                </button>
              </div>
            {%- endif -%}
          {%- endif -%}
        </div>
      </div>
      {% unless disable_quickview %}
        <div class="md:list-layout:hidden" x-show="$store.xQuickView" :class="$store.xQuickView && $store.xQuickView.btn_atc_bottom ? 'mobile-bottom':''">
          {%- unless settings.hide_cart -%} 
            <div class="quick-view-container absolute z-20 bottom-2 right-2 rtl:right-auto rtl:left-2 rtl:lg:left-auto lg:top-auto lg:right-auto lg:bottom-4 lg:w-full lg:group-hover:opacity-100 lg:group-hover:translate-y-0 focus:opacity-100 focus:translate-y-0 lg:translate-y-full transition-all duration-[var(--transition-card-image-hover)] ease-in-out lg:opacity-0"
              x-show="$store.xQuickView" x-cloak
            > 
              <div x-data="xProductCart" x-show="$store.xQuickView && $store.xQuickView.show_atc_button"
                class="w-full{% if show_icon_atc %} hide-btn text-right rtl:text-left lg:pl-2 lg:pr-2{% else %} hide-icon lg:px-4{% endif %}" 
                :class="if($store.xQuickView){ return ($store.xQuickView.btn_atc_bottom ? 'hidden' : '') + ($store.xQuickView.atc_btn_image_desktop ? ' lg:block' : ' lg:hidden') }"
                x-cloak
              >
                {%- assign swatch_count = 0 -%}   
                {%- for option in card_product.options_with_values -%}
                  {% liquid
                    assign show_swatch = false
                    assign show_color_swatch = false
                    assign show_text_swatch = false
                    if settings.text_option_name contains option.name and settings.swatches_type == 'text'
                      assign show_text_swatch = true
                    endif
                    if settings.color_option_name contains option.name and settings.swatches_type == 'color'
                      assign show_color_swatch = true
                    endif
                    if settings.swatches_type == 'both_text_and_color'
                      if settings.text_option_name contains option.name or settings.color_option_name contains option.name
                        assign show_swatch = true
                      endif
                    endif
                  %}
                  {% if show_swatch or show_text_swatch or show_color_swatch %}
                    {%- assign swatch_count = swatch_count | plus: 1 -%}
                  {% endif %}
                {%- endfor -%}
                {% if card_product.options_with_values.size == swatch_count or card_product.has_only_default_variant %}
                  {%- assign product_form_id = 'product-form-choose-option' | append: card_product.id | append: index_param -%}
                  {%- form 'product', card_product, id: product_form_id, class: 'form h-full', novalidate: 'novalidate', data-type: 'add-to-cart-form', x-ref: 'product_form' -%}
                    <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}">
                    {% if settings.show_in_cart_items != 'none' %}
                      {% render 'estimate-shipping-cart', product: card_product, message: settings.message_estimate_cart, disable_cart_edt: disable_cart_edt %}
                    {% endif %}
                    {% if can_show_preorder %}
                      <input name="properties[{{ 'general.preorder.name' | t }}]" class="hidden" value="{{ message_preorder }}"/>
                    {% endif %}                                            
                    <button
                      type="submit"
                      name="add"
                      {%- if card_product.has_only_default_variant or card_product.selected_or_first_available_variant.available == false -%}
                        @click.prevent="errorMessage == false && addToCart($event)"
                      {%- else -%}
                        {% if settings.products_color_swatches_enable_on_collection_page %}
                          @click.prevent="errorMessage == false && addToCart($event)"
                        {% else %}
                          @click.prevent="setTimeout(() => { $store.xQuickView && (showOptions = !showOptions); $store.xQuickView.showChooseOption('{{ section_id }}-{{ card_product.id }}-{{ block_id }}', $el); }, 0)"
                          x-on:mouseover="setTimeout(() => { $store.xQuickView && $store.xQuickView.loadChooseOptions('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}', {{ index_param }}); }, 0)"
                        {% endif %}
                      {%- endif -%}
                      data-id="{{ section_id }}-{{ card_product.id }}-{{ block_id }}"
                      class="button button--quickview button-solid not-icon leading-normal w-full pr-5 pl-5 py-2.5 lg:py-3 h-full z-50 text-[12px] lg:text-[14px] lg:-translate-x-0 disabled:cursor-not-allowed disabled:opacity-60 hidden{% if show_icon_atc %} xl:block{% else %} lg:block{% endif %}"
                      {% if settings.enable_shipping_insurance and settings.shipping_insurance_added_by_default and shipping_insurance %}
                        x-init="loadInsurance('{{ shipping_insurance }}')"
                      {% endif %}
                      {% if settings.enable_shipping_insurance and settings.product_shipping_insurance != blank and settings.product_shipping_insurance.id == card_product.id %}
                        style="display: none;"
                      {% endif %}
                      :class="errorMessage && 'opacity-60 cursor-not-allowed'"
                      {% if card_product.selected_or_first_available_variant.available == false %}
                        disabled
                        aria-label="{{ 'products.product.sold_out' | t }}"
                      {% else %}
                        {%- if card_product.has_only_default_variant -%}
                          aria-label="{{ 'products.product.add_to_cart' | t }}"
                        {% else %}
                          {% if settings.products_color_swatches_enable_on_collection_page %}
                            aria-label="{{ 'products.product.add_to_cart' | t }}"
                          {% else %}
                            aria-label="{{ 'products.product.choose_options' | t }}"
                          {% endif %}
                        {% endif %}
                      {% endif %}
                    >
                      <span :class="{ 'lg:block opacity-0 is-focus-button' : loading, 'hidden' : errorMessage}">
                        {%- if card_product.selected_or_first_available_variant.available -%}
                          {%- if card_product.has_only_default_variant -%}
                            {% liquid
                              if can_show_preorder
                                assign button_label = 'products.product.pre_order' | t
                                if settings.card_button_preorder != blank
                                  assign button_label = settings.card_button_preorder
                                endif
                              else 
                                assign button_label = 'products.product.add_to_cart' | t
                              endif
                            %}
                            <span class="flex items-center justify-center">
                              {% render 'button-label', button_label: button_label, show_button_style: 'primary' %}
                            </span>
                          {%- else -%}
                            {% liquid
                              if settings.products_color_swatches_enable_on_collection_page
                                if can_show_preorder
                                  assign button_label = 'products.product.pre_order' | t
                                  if settings.card_button_preorder != blank
                                    assign button_label = settings.card_button_preorder
                                  endif
                                else 
                                  assign button_label = 'products.product.add_to_cart' | t
                                endif
                              else
                                assign button_label = 'products.product.choose_options' | t
                              endif
                            %}
                            <span class="flex items-center justify-center">
                              {% render 'button-label', button_label: button_label, show_button_style: 'primary' %}
                            </span>
                          {%- endif -%}
                        {%- else -%}
                          {{ 'products.product.sold_out' | t }}
                        {%- endif -%}
                      </span>
                      <div
                        class="flex gap-x-2 items-center justify-center"
                        role="alert"
                        x-cloak
                        x-show="errorMessage"
                      >
                        {{ 'products.product.sold_out' | t }}
                      </div>
                      <div class="lg:inline-block animate-spin w-4 h-4 md:w-5 md:h-5 absolute top-[calc(50%-8px)] left-[calc(50%-8px)] md:top-[calc(50%-10px)] md:left-[calc(50%-10px)]" x-show="loading" x-cloak>
                        {% render 'icon-alls', icon: 'icon-loading' %}
                      </div>
                    </button>
                    <button 
                      type="submit"
                      name="add"
                      {%- if card_product.has_only_default_variant or card_product.selected_or_first_available_variant.available == false -%}
                        @click.prevent="errorMessage == false && addToCart($event)"
                      {%- else -%}
                        {% if settings.products_color_swatches_enable_on_collection_page %}
                          @click.prevent="errorMessage == false && addToCart($event)"
                        {% else %}
                          @click.prevent="setTimeout(() => { $store.xQuickView && (showOptions = !showOptions); $store.xQuickView.showChooseOption('{{ section_id }}-{{ card_product.id }}-{{ block_id }}', $el); }, 0)"
                          x-on:mouseover="setTimeout(() => { $store.xQuickView && $store.xQuickView.loadChooseOptions('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}', {{ index_param }}); }, 0)"
                        {% endif %}
                      {%- endif -%}
                      class="button label-btn-quickview button-disable-effect not-icon button--quickview rounded-full lg:leading-snug none_border{% if show_icon_atc %} xl:hidden{% else %} lg:hidden{% endif %} h-full p-[6px] disabled:cursor-not-allowed disabled:opacity-60"
                      {% if settings.enable_shipping_insurance and settings.shipping_insurance_added_by_default and shipping_insurance %}
                        x-init="loadInsurance('{{ shipping_insurance }}')"
                      {% endif %}
                      {% if settings.enable_shipping_insurance and settings.product_shipping_insurance != blank and settings.product_shipping_insurance.id == card_product.id %}
                        style="display: none;"
                      {% endif %}
                      data-id="{{ section_id }}-{{ card_product.id }}-{{ block_id }}"
                      :class="errorMessage && 'opacity-60 cursor-not-allowed'"
                      {% if card_product.selected_or_first_available_variant.available == false %}
                        disabled
                        aria-label="{{ 'products.product.sold_out' | t }}"
                      {% else %}
                        {%- if card_product.has_only_default_variant -%}
                          aria-label="{{ 'products.product.add_to_cart' | t }}"
                        {% else %}
                          {% if settings.products_color_swatches_enable_on_collection_page %}
                            aria-label="{{ 'products.product.add_to_cart' | t }}"
                          {% else %}
                            aria-label="{{ 'products.product.choose_options' | t }}"
                          {% endif %}
                        {% endif %}
                      {% endif %}
                      x-customer-event-data="{{ data_for_customer_event | escape }}"
                    >
                      <span class="w-5 h-5 flex items-center justify-center md:w-6 md:h-6" x-show="!loading">{%- render 'icon-cart-all', icon: 'icon-cart-quick-add' -%}</span>
                      <span class="block w-5 h-5 animate-spin" x-show="loading" x-cloak>
                        {% render 'icon-alls', icon: 'icon-loading' %}
                      </span>
                  </button>
                  {%- endform -%}
                {% else %}
                  <button
                    type="submit"
                    name="add"
                    
                    @click.prevent="setTimeout(() => { $store.xQuickView && (showOptions = !showOptions); $store.xQuickView.showChooseOption('{{ section_id }}-{{ card_product.id }}-{{ block_id }}', $el); }, 0)"
                    x-on:mouseover="setTimeout(() => { $store.xQuickView && $store.xQuickView.loadChooseOptions('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}', {{ index_param }}); }, 0)"
                    data-id="{{ section_id }}-{{ card_product.id }}-{{ block_id }}"
                    class="button button--quickview button-solid not-icon leading-normal w-full pr-5 pl-5 py-2.5 lg:py-3 h-full text-[12px] lg:text-[14px] lg:-translate-x-0 disabled:cursor-not-allowed disabled:opacity-60 hidden{% if show_icon_atc %} xl:block{% else %} lg:block{% endif %}"
                    :class="errorMessage && 'opacity-60 cursor-not-allowed'"
                    aria-label="{{ 'products.product.choose_options' | t }}"
                  >
                    <span :class="{ 'lg:block opacity-0 is-focus-button' : loading, 'hidden' : errorMessage}">
                      {% assign button_label = 'products.product.choose_options' | t %}
                      <span class="flex items-center justify-center">
                        {% render 'button-label', button_label: button_label, show_button_style: 'primary' %}
                      </span>
                    </span>
                    <div class="lg:inline-block animate-spin w-4 h-4 md:w-5 md:h-5 absolute top-[calc(50%-8px)] left-[calc(50%-8px)] md:top-[calc(50%-10px)] md:left-[calc(50%-10px)]" x-show="loading" x-cloak>
                      {% render 'icon-alls', icon: 'icon-loading' %}
                    </div>
                  </button>
                  <button 
                    type="submit"
                    name="add"
                    
                    @click.prevent="setTimeout(() => { $store.xQuickView && (showOptions = !showOptions); $store.xQuickView.showChooseOption('{{ section_id }}-{{ card_product.id }}-{{ block_id }}', $el); }, 0)"
                    x-on:mouseover="setTimeout(() => { $store.xQuickView && $store.xQuickView.loadChooseOptions('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}', {{ index_param }}); }, 0)"
                    class="button label-btn-quickview button-disable-effect not-icon button--quickview rounded-full lg:leading-snug none_border{% if show_icon_atc %} xl:hidden{% else %} lg:hidden{% endif %} h-full p-[6px] disabled:cursor-not-allowed disabled:opacity-60"
                    data-id="{{ section_id }}-{{ card_product.id }}-{{ block_id }}"
                    :class="errorMessage && 'opacity-60 cursor-not-allowed'"
                    {% if card_product.selected_or_first_available_variant.available == false %}
                      disabled
                      aria-label="{{ 'products.product.sold_out' | t }}"
                    {% else %}
                      {%- if card_product.has_only_default_variant -%}
                        aria-label="{{ 'products.product.add_to_cart' | t }}"
                      {% else %}
                        {% if settings.products_color_swatches_enable_on_collection_page %}
                          aria-label="{{ 'products.product.add_to_cart' | t }}"
                        {% else %}
                          aria-label="{{ 'products.product.choose_options' | t }}"
                        {% endif %}
                      {% endif %}
                    {% endif %}
                    x-customer-event-data="{{ data_for_customer_event | escape }}"
                  >
                    <span class="w-5 h-5 flex items-center justify-center md:w-6 md:h-6" x-show="!loading">{%- render 'icon-cart-all', icon: 'icon-cart-quick-add' -%}</span>
                    <span class="block w-5 h-5 animate-spin" x-show="loading" x-cloak>
                    {% render 'icon-alls', icon: 'icon-loading' %}
                    </span>
                  </button>
                {% endif %}                 
              </div>
            </div>
          {%- endunless -%} 
          <div
            class="button-quickview-icon absolute z-[15] lg:group-hover:opacity-100 lg:group-hover:translate-y-0 focus:opacity-100 focus:translate-y-0  transition-all duration-[var(--transition-card-image-hover)] ease-in-out lg:opacity-0"
            :class="$store.xQuickView && $store.xQuickView.show_atc_button ? 'btn-quickadd {% if settings.hide_cart %} bottom-2{% else %} bottom-11{% endif %} md:bottom-12 right-2 lg:top-2 lg:bottom-auto lg:-translate-y-full rtl:right-auto rtl:left-2' : 'bottom-2 right-0 lg:top-auto lg:translate-y-full lg:right-auto lg:bottom-4 lg:w-full lg:left-0 pl-2 pr-2 lg:pr-4 lg:pl-4'"
            x-show="$store.xQuickView && $store.xQuickView.enabled" x-cloak
            >
            <div>
              <button
                @click.prevent='$store.xQuickView && $store.xQuickView.open(); $store.xCustomerEvent.fire("product_selected", $el);' 
                x-on:mouseover="$store.xQuickView && $store.xQuickView.load('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}')" 
                x-on:focus="$store.xQuickView && $store.xQuickView.load('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}')" 
                class="button label-btn-quickview button--quickview not-icon leading-normal empty:hidden hidden lg:block z-50 h-full"
                :class="$store.xQuickView && $store.xQuickView.show_atc_button ? 'p-1.5 md:p-3 rounded-full button-disable-effect' : 'w-full pt-3 pb-3 button-solid'"
                x-customer-event-data="{{ data_for_customer_event | escape }}"
                aria-label="{{ 'products.product.button_quickview' | t }}"
              >
                <span x-show="$store.xQuickView && $store.xQuickView.show_atc_button" class="w-4 h-4 flex items-center">
                  {%- render 'icon-alls', icon: 'icon-search-quickview' -%}
                </span>
                <span x-show="$store.xQuickView && !$store.xQuickView.show_atc_button" class="flex items-center justify-center">
                  {% render 'button-label', x_text_quickview: true, show_button_style: 'primary' %}
                </span>
              </button>
              <button @click.prevent='$store.xQuickView && $store.xQuickView.load("{{ card_product.url | within: collection | split: "?" | first }}", $el, "{{ section_id }}-{{ card_product.id }}-{{ block_id }}"); $store.xQuickView && $store.xQuickView.open(); $store.xCustomerEvent.fire("product_selected", $el);' 
                class="button label-btn-quickview button-disable-effect not-icon button--quickview rounded-full lg:leading-snug none_border lg:hidden h-full p-2" 
                aria-label="{{ 'products.product.button_quickview' | t }}"
                x-customer-event-data="{{ data_for_customer_event | escape }}"
              >
                <span class="w-4 h-4 md:w-5 md:h-5 flex items-center">{%- render 'icon-alls', icon: 'icon-search-quickview' -%}</span>
              </button>
            </div>
          </div>
        </div>
      {% endunless %}
    </a>
    {% if product_complementary %}
      </div>
    {% endif %}
    {% capture card_info %}
      <div class="card-info{% if product_complementary %} pl-4 pt-1{% elsif collage %} pt-3.5{% else %} pt-5{% endif %} md:list-layout:pt-0 md:list-layout:lg:pt-0{% if card_full_width %} pl-5 pr-5 md:pl-0 md:pr-0{% endif %}">
        <div class="no-collage:mb-2{% unless product_complementary %} text-{{ content_alignment }}{% else %} pr-4{% endunless %} {% unless is_rtl %} md:list-layout:text-left{% else %} md:list-layout:text-right{% endunless %}">
          <div class="below-image ltr flex flex-wrap justify-{{ content_alignment }} md:list-layout:justify-start rtl:md:list-layout:justify-end mb-2 gap-1 empty:hidden"></div>
          {%- if show_vendor -%}
            <div class="mb-0.5 uppercase tracking-widest {% if mediaGallery %}card-product-vendor-text-{{ block_id }}{% else %}text-small{% endif %} p-break-words">{{ card_product.vendor }}</div>
          {%- endif -%}
          <{% if product_complementary %}p{% else %}h3{% endif %} class="card__heading h5 no-collage:mb-2 mb-3 leading-tight"{% if card_product.featured_media %} id="title-{{ section_id }}-{{ card_product.id }}"{% endif %}>
            <a href="{{ card_product.url | within: collection }}"
              class="x-card-title full-unstyled-link link-product-variant {% if mediaGallery %}card-product-title-text-{{ block_id }}{% endif %} text-[rgba(var(--colors-heading))] hover:text-[rgba(var(--colors-text-link))] cursor-pointer duration-200 p-break-words"
              @click='$store.xCustomerEvent.fire("product_selected", $el)'
              x-customer-event-data="{{ data_for_customer_event | escape }}"
            >
              {{ card_product.title | escape }}
            </a>
          {% if product_complementary %}</p>{% else %}</h3>{% endif %}
          {% if show_highlighted_attributes %}
            {% render 'highlight-icon-card-product', card_product: card_product, content_alignment: content_alignment %}
          {% endif %}
          {%- if show_rating -%}
            {%-liquid 
              if product_complementary 
                assign content_alignment = 'left' 
                if settings.lang_direction contains request.locale.iso_code
                  assign content_alignment = 'right'
                endif
              endif
            %}
            {% render 'review-product', product: card_product, content_alignment: content_alignment, card_product: true %}
          {%- endif -%}
          <div{% unless product_complementary %} class="{% if mediaGallery %} card-product-price-text-{{ block_id }} {% endif %}x-card-price flex items-center mb-3 flex-wrap gap-1{% unless content_alignment == 'right' %} justify-{{ content_alignment }} rtl:flex-row-reverse md:rtl:list-layout:flex-row md:list-layout:justify-start{% endunless %}{% if content_alignment == 'right' %} flex-row-reverse rtl:flex-row md:list-layout:flex-row{% endif %}"{% else %} class="x-card-price mb-3"{% endunless %}>
            {% assign priceID = section_id | append: '-' | append: product_card_id %}
            {% if card_product.options_with_values.size == swatch_count %}
              {%- render 'price',
                product: card_product,
                use_variant: true,
                container: 'main-product-price'
              -%}
            {% else %}
              {% render 'price', priceID: priceID, product: card_product, product_complementary: product_complementary, show_price_range: show_price_range %}
            {% endif %}
            <div class="next-price empty:hidden"></div>
          </div>
          <div id="x-availability-notice-{{ section.id }}" class="flex items-center flex-wrap gap-1{% unless product_complementary %}{% unless content_alignment == 'right' %} justify-{{ content_alignment }}{% endunless %} rtl:flex-row-reverse md:rtl:list-layout:flex-row md:list-layout:justify-start{% if content_alignment == 'right' %} flex-row-reverse rtl:flex-row md:list-layout:flex-row{% endif %}{% endunless %}" x-show="$store.xStoreSelector?.canShow('{{ card_product.id }}', [{{ card_product.collections | map: 'id' | join: ', ' }}])">
            {%- render 'availability-notice',
              product: card_product
            -%}
          </div>
        </div>
      </div>
    {% endcapture %}
    <div class="md:list-layout:hidden{% if product_complementary %} w-5/6{% endif %}">{{ card_info }}</div>
    {% if product_complementary %}
      <template x-if="$store.xQuickView && $store.xQuickView.enabled">
        {%- if card_product.variants.size == 1 -%}
          {%- unless settings.hide_cart -%}
            <div x-data="xProductCart" x-show="$store.xQuickView.show_atc_button">
              {%- assign product_form_id = 'product-form-choose-option' | append: card_product.id | append: index_param -%}
              {%- form 'product', card_product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form', x-ref: 'product_form' -%}
                <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}">
                {% if settings.show_in_cart_items != 'none' %}
                  {% render 'estimate-shipping-cart', product: card_product, message: settings.message_estimate_cart, disable_cart_edt: disable_cart_edt %}
                {% endif %}
                {% if can_show_preorder %}
                  <input name="properties[{{ 'general.preorder.name' | t }}]" class="hidden" value="{{ message_preorder }}"/>
                {% endif %}
                <button
                  type="submit"
                  name="add"
                  {% if add_as_bundle %}
                    @click.prevent="errorMessage == false && validateError($el) && validateErrorAddAsBundle($el) && addToCart($event);"
                    data-add-as-bundle="true"
                  {% else %}
                    @click.prevent="errorMessage == false && addToCart($event);"
                  {% endif %}
                  class="relative button button-action not-icon rounded-sm w-[30px] inline-block pt-2 pb-2 pr-2 pl-2"
                  {% if settings.enable_shipping_insurance and settings.shipping_insurance_added_by_default and shipping_insurance %}
                    x-init="loadInsurance('{{ shipping_insurance }}')"
                  {% endif %}
                  {% if settings.enable_shipping_insurance and settings.product_shipping_insurance != blank and settings.product_shipping_insurance.id == card_product.id %}
                    style="display: none;"
                  {% endif %}
                  {% if card_product.selected_or_first_available_variant.available == false %}
                    disabled
                    aria-label="{{ 'products.product.sold_out' | t }}"
                  {% else %}
                    aria-label="{{ 'products.product.add_to_cart' | t }}"
                  {% endif %}>
                  <span :class="loading && 'opacity-0'" class="block">{% render 'icon-alls', icon: 'icon-add-complementary' %}</span>
                  <div class="inline-block w-5 h-5 animate-spin absolute top-[calc(50%-10px)] left-[calc(50%-10px)]" x-show="loading" x-cloak>
                    {% render 'icon-alls', icon: 'icon-loading' %}
                  </div>
               </button>
              {%- endform -%}
            </div>
          {%- endunless -%} 
        {% endif %}
        <div x-show="{% if card_product.variants.size == 1 %}false{% else %}true{% endif %} || !$store.xQuickView.show_atc_button">
          <button
            class="button button-action not-icon rounded-sm w-[30px] inline-block pt-2 pb-2 pr-2 pl-2"
            id="button-quickview-{{ section_id }}-{{ card_product.id }}-{{ block_id }}"
            {% if add_as_bundle %}
              data-add-as-bundle="true"
              @click.prevent='validateError($el) && validateErrorAddAsBundle($el) && $store.xQuickView && $store.xQuickView.open(); validateErrorAddAsBundle($el) && $store.xCustomerEvent.fire("product_selected", $el);'
              x-on:mouseover="validateErrorAddAsBundle($el) && $store.xQuickView && $store.xQuickView.load('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}')"
              x-on:focus="validateErrorAddAsBundle($el) && $store.xQuickView && $store.xQuickView.load('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}')"
            {% else %}
              @click.prevent='$store.xQuickView && $store.xQuickView.open(); $store.xCustomerEvent.fire("product_selected", $el);'
              x-on:mouseover="$store.xQuickView && $store.xQuickView.load('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}')"
              x-on:focus="$store.xQuickView && $store.xQuickView.load('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}')"
            {% endif %}
            x-customer-event-data="{{ data_for_customer_event | escape }}"
            aria-label="{{ 'products.product.add_to_cart' | t }}"
          >
            <span>{% render 'icon-alls', icon: 'icon-add-complementary' %}</span>
          </button>
        </div>
      </template>
    {% endif %}
  </div>
  {%- if card_product.selected_or_first_available_variant.available and card_product.has_only_default_variant == false -%}
    <div
      id="choose-options-{{ section_id }}-{{ card_product.id }}-{{ block_id }}"
      class="hidden md:block absolute w-full min-h-full h-full left-0 top-0 bg-[rgba(var(--background-color))] z-[15] md:list-layout:w-3/5 list-layout:lg:w-3/4{% if is_rtl %} md:list-layout:right-auto md:list-layout:left-0{% else %} md:list-layout:left-auto md:list-layout:right-0{% endif %}"
      x-show="showOptions"
      x-transition:enter="transition-all ease-in-out duration-300"
      x-transition:enter-start="opacity-0 transform translate-y-full"
      x-transition:enter-end="opacity-100 transform translate-y-0"
      x-transition:leave="transition-all ease-in-out duration-300"
      x-transition:leave-start="opacity-100 transform translate-y-0"
      x-transition:leave-end="opacity-0 transform translate-y-full"
      x-cloak
    >
      <div
        class="choose-options relative w-full min-h-full h-full"
      >
      </div>
      <div class="icon-loading hidden absolute top-0 left-0 right-0 h-full w-full z-20 bg-[rgba(var(--background-color))]">
        <div
          class="lg:inline-block animate-spin w-4 h-4 md:w-5 md:h-5 absolute top-[calc(50%-8px)] left-[calc(50%-8px)] md:top-[calc(50%-10px)] md:left-[calc(50%-10px)]">
          {% render 'icon-alls', icon: 'icon-loading' %}
        </div>
      </div>
    </div>
  {%- endif -%}
  {% comment %} Show the product details when card product is in list view {% endcomment %}
  <div
    id="x-product-template-{{ card_product.id }}-{{ section_id }}-{{ product_card_id }}"
    class="list-layout:lg:w-3/4 md:list-layout:w-3/5 list-layout:md:p-5 list-layout:md:pl-0 rtl:list-layout:md:pl-5 rtl:list-layout:md:pr-0 {% unless product_complementary %} text-{{ content_alignment }}{% endunless %}{% if is_rtl %} md:list-layout:text-right{% endif %}"
  >
    <div class="hidden md:list-layout:block">
      {{ card_info }}
    </div>
    {% unless disable_color_swatch %}
      {%- if settings.products_color_swatches_enable_on_collection_page -%}
        {%- unless card_product.has_only_default_variant or product_complementary -%}
          {% liquid
            assign is_cbl = false
            if settings.enable_combined
              assign is_cbl = true
            endif
          %}
          <div
            class="x-variants-data"
            {% if settings.swatches_type == 'both_text_and_color' or settings.swatches_type == 'color' %}
              x-data="xVariantSelect($el,'{{ section_id }}-{{ product_card_id }}', false, '{{ 'products.product.unavailable' | t }}', '{{ card_product.url | within: collection | split: "?" | first }}', '{{ card_product.id }}', false, true, false, '{{ section.id }}', '', '', '{{ card_product.featured_media | image_url | default: "" }}', {{ index_param }})"
              {% unless is_cbl %}x-init="initVariant()"{% endunless %}
            {% endif %}
          >
            <script type="application/json">
              {{ card_product.variants | json }}
            </script>
            <div
              id="current-variant-{{ section_id }}-{{ card_product.id }}-{{ block_id }}" 
              class="current-variant hidden"
            >
              {{ card_product.selected_or_first_available_variant.id }}
            </div>
            <div
              id="variant-update-{{ section_id }}-{{ product_card_id }}"
              class="variant-update-{{ section_id }}-{{ product_card_id }} list-layout:md:text-left rtl:list-layout:md:text-right options-container"
            >
              {%- for option in card_product.options_with_values -%}
                {%- assign variant_key = 'option' | append: option.position -%}
                {% liquid
                  assign show_swatch = false
                  assign show_color_swatch = false
                  assign show_text_swatch = false
                  if settings.text_option_name contains option.name and settings.swatches_type == 'text'
                    assign show_text_swatch = true
                  endif
                  if settings.color_option_name contains option.name and settings.swatches_type == 'color'
                    assign show_color_swatch = true
                  endif
                  if settings.swatches_type == 'both_text_and_color'
                    if settings.text_option_name contains option.name or settings.color_option_name contains option.name
                      assign show_swatch = true
                    endif
                  endif
                %}
                {% if show_swatch or show_text_swatch or show_color_swatch %}
                {%- assign option_index = forloop.index | minus: 1 -%}
                  <fieldset
                    id="Option-{{ section_id }}-{{ product_card_id }}-{{ forloop.index0 }}"
                    class="product-form__input pl-0 pb-3 quick-view:pb-2 eurus gap-x-2"
                    x-intersect.once.margin.500px="options[{{ forloop.index | minus: 1 }}] = document.querySelector('#Option-{{ section_id }}-{{ product_card_id }}-{{ forloop.index0 }} input[checked]').value"
                  >
                    <div class="mb-2 hidden">{{ option.name }}</div>
                    <div class="inline-flex flex-wrap ltr items-center{% if settings.swatches_type == 'color' or settings.swatches_type == 'both_text_and_color' and settings.color_option_name contains option.name %} ml-0.5 mr-0.5 gap-2.5{% else %} gap-1.5{% endif %}{% if collage %} justify-{{ info_alignment }}{% else %} justify-{{ settings.info_alignment_card_product }}{% endif %}">
                      {%- liquid
                        assign variants_available_arr = card_product.variants | map: 'available'
                        assign variants_option_1_arr = card_product.variants | map: 'option1'
                        assign variants_option_2_arr = card_product.variants | map: 'option2'
                        assign variants_option_3_arr = card_product.variants | map: 'option3'
                      
                        assign color_option_values = settings.color_option_values | newline_to_br | strip_newlines | split: '<br />'
                        assign text_option_values = settings.text_option_values | newline_to_br | strip_newlines | split: '<br />'

                        if settings.products_color_swatches_style == 'round' 
                          assign classSwatch = ' rounded-full before:rounded-full'
                        elsif settings.edges_type == 'rounded_corners'
                          assign classSwatch = ' rounded-md overflow-hidden'
                        endif
                        if settings.swatch_show_by_default != 0
                          assign count_value = option.values.size
                          if count_value > settings.swatch_show_by_default
                            assign is_count = true
                            assign count_value = count_value | minus: settings.swatch_show_by_default
                          endif
                        endif

                        assign swatch_natural = false     
                        if settings.products_color_swatches_style == 'natural'
                          assign swatch_natural = true
                        endif
                        assign ratio_image = false
                      -%}
                      {%- for value in option.values -%}
                        {%- liquid
                          assign preview_image = blank
                          assign variant_value = card_product.variants | where: variant_key, value | first
                          if variant_value.featured_media.preview_image
                            assign preview_image = variant_value.featured_media.preview_image
                            unless ratio_image
                              assign ratio_image = 1 | divided_by: variant_value.featured_media.preview_image.aspect_ratio | times: 100
                            endunless
                          elsif card_product.featured_media
                            assign preview_image = card_product.featured_media
                            unless ratio_image
                              assign ratio_image = 1 | divided_by: card_product.featured_media.aspect_ratio | times: 100
                            endunless
                          endif
                          assign option_disabled = true
                      
                          for option1_name in variants_option_1_arr
                            case option.position
                              when 1
                                if variants_option_1_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                                  assign option_disabled = false
                                endif
                              when 2
                                if option1_name == card_product.selected_or_first_available_variant.option1 and variants_option_2_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                                  assign option_disabled = false
                                endif
                              when 3
                                if option1_name == card_product.selected_or_first_available_variant.option1 and variants_option_2_arr[forloop.index0] == card_product.selected_or_first_available_variant.option2 and variants_option_3_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                                  assign option_disabled = false
                                endif
                            endcase
                          endfor
                        -%}
                        {%- liquid
                          assign color_custom = ''
                          assign swatch_image = false
                          assign color_value = ''
                          for color_option_value in color_option_values reversed
                            assign option_key = color_option_value | split: ':' | first
                            assign option_value = color_option_value | split: ':' | last | strip
                    
                            if option_key == value and option_value contains '.'
                              assign color_custom = option_key
                              assign swatch_image = true
                              assign color_value = option_value
                              break
                            endif
                            assign multi_colors = option_value | remove_first: '#' | split: '#'
                            if option_key == value
                              assign color_custom = option_key
                              assign color_value = option_value
                              break
                            endif
                          endfor  
                        -%}
                        {% if preview_image and settings.replace_color_with_variant_images %}
                          {% if settings.color_option_name contains option.name %}
                            {%- style %}
                              .color-watches.variant-{{ product_card_id }}-{{ option.position }}-{{ forloop.index0 }}-{{ card_product.id }}:before {
                                background-image: var(--bg-image);
                              }
                            {%- endstyle %}
                          {% endif %}
                        {% elsif color_custom != '' %}
                          {%- style %}
                            {% if swatch_image %}
                              [data-swatch="{{ color_custom }}"]:before {
                                background-image: url({{ color_value | file_img_url: "100x100" }});
                              }
                            {% elsif multi_colors.size == 3 %}
                              [data-swatch="{{ color_custom }}"]:before {
                                background: linear-gradient(45deg, {{ '#' | append: multi_colors[0] }}, {{ '#' | append: multi_colors[0] }} 33.3%, {{ '#' | append: multi_colors[1] }} 33.3%, {{ '#' | append: multi_colors[1] }} 66.6%, {{ '#' | append: multi_colors[2] }} 66.6%, {{ '#' | append: multi_colors[2] }});
                              }
                            {% elsif multi_colors.size == 2 %}
                              [data-swatch="{{ color_custom }}"]:before {
                                background: linear-gradient(45deg, {{ '#' | append: multi_colors[0] }}, {{ '#' | append: multi_colors[0] }} 50%, {{ '#' | append: multi_colors[1] }} 50%, {{ '#' | append: multi_colors[1] }});
                              }
                            {% else %}
                              [data-swatch="{{ color_custom }}"]:before {
                                background: {{ color_value }};
                              }
                            {% endif %}
                          {%- endstyle %}
                        {% endif %}
                        <input 
                          id="{{ section_id }}-{{ product_card_id }}-{{ option.position }}-{{ forloop.index0 }}-{{ card_product.id }}"
                          section-id="{{ section_id }}-{{ product_card_id }}"
                          option-pos="{{ option.position }}"
                          forloop="{{ forloop.index0 }}"
                          type="radio"
                          name="{{ option.name }}-{{ product_card_id }}-{{ section_id }}"
                          value="{{ value | escape | replace: '&lt;', '\u003c' | replace: '&gt;', '\u003e' }}"
                          form="{{ product_form_id }}"
                          class="absolute opacity-0 h-1 w-1 input-radio{% if option_disabled and settings.swatches_type != 'both_text_and_color' %} disabled{% endif %}"
                          {% if settings.swatches_type == 'both_text_and_color' %}
                            {% if option_index > 0 %}
                              :class="{'disabled': isSelect && (!currentAvailableOptions[{{ option_index }}] || !currentAvailableOptions[{{ option_index }}].includes(`{{ value | escape }}`))}"
                            {% elsif option_disabled %}
                              :class="{'disabled': isSelect }"
                            {% endif %}
                            x-model="options[{{ option_index }}]"
                          {% endif %}
                          {% if settings.swatches_type == 'both_text_and_color' and card_product.options_with_values.size > 1 %}
                            x-on:change="setTimeout(() => { $store.xBadges && $store.xBadges.load(document.getElementById('{{ card_product.id }}-{{ section.id }}'), () => {}, null, true);$store.xPreviewColorSwatch.onChangeVariant($el,'{{ card_product.url | within: collection | split: "?" | first }}', '{{ card_product.featured_media | image_url | default: "" }}', {{ variant_value.id | default: "" }}, '{{ section_id }}-{{ product_card_id }}', {% if settings.swatches_type == 'color' or settings.swatches_type == 'both_text_and_color' and settings.color_option_name contains option.name %}true{% endif %}) }, 0)"
                          {% else %}
                            x-on:change="setTimeout(() => { $store.xBadges && $store.xBadges.load(document.getElementById('{{ card_product.id }}-{{ section.id }}'), () => {}, null, true);$store.xPreviewColorSwatch.updateImage($el,'{{ card_product.url | within: collection | split: "?" | first }}', '{{ preview_image | image_url | default: "" }}', '{{ variant_value.id }}'); $store.xQuickView.show_atc_button && $store.xPreviewColorSwatch.updateQuickAdd('{{ card_product.url | within: collection | split: "?" | first }}','{{ variant_value.id }}', {% if index_param %}{{ index_param }},{% endif %} '{{ card_product.id }}') }, 0)"
                          {% endif %}
                          aria-label="{{ value | escape }}"
                          {% if forloop.first %}
                            checked
                          {% endif %}
                        >
                        {% if settings.swatches_type == 'color' or settings.swatches_type == 'both_text_and_color' and settings.color_option_name contains option.name %}
                          <label 
                            class="color-watches variant-{{ product_card_id }}-{{ option.position }}-{{ forloop.index0 }}-{{ card_product.id }} cursor-pointer block{% if swatch_natural and settings.replace_color_with_variant_images and ratio_image %} color-swatch-natural{% endif %} swatch-{{ settings.swatch_size }} relative{{ classSwatch }}" 
                            for="{{ section_id }}-{{ product_card_id }}-{{ option.position }}-{{ forloop.index0 }}-{{ card_product.id }}" 
                            data-swatch="{{ color_custom }}"
                            data-optionindex="{{ option_index }}"
                            data-optionvalue="{{ value | escape | replace: '&lt;', '\u003c' | replace: '&gt;', '\u003e' }}"
                            {% if preview_image == blank or settings.replace_color_with_variant_images == false and color_custom == '' %}
                              {% liquid
                                if value.swatch.image
                                  assign image_url = value.swatch.image | image_url: width: 50
                                  assign swatch_value = 'url(' | append: image_url | append: ')'
                                elsif value.swatch.color
                                  assign swatch_value = 'rgb(' | append: value.swatch.color.rgb | append: ')'
                                else
                                  assign swatch_value = value | split: ' ' | last | handle
                                endif
                              %}
                              style="background: {{ swatch_value }};"
                            {% elsif swatch_natural and ratio_image %}
                              style="--ratio-image: {{ ratio_image }}%; --bg-image: url('{{ preview_image | image_url: width: 100, height: 100 }}')"
                            {% else %}
                              style="--bg-image: url('{{ preview_image | image_url: width: 100, height: 100 }}')"
                            {% endif %}
                            tabindex="0"
                            data-name="{{ value | escape }}"
                            aria-label="{{ value | escape }}"
                          >
                            <span class="h-full w-full color-watches-disable"></span>
                          </label>
                          {% if settings.swatch_show_by_default != 0 %}
                            {% capture enable_count %}
                              <p class="mb-2 ml-0.5">+{{ count_value }}</p>
                            {% endcapture %}
                            {% liquid
                              assign max = settings.swatch_show_by_default | minus: 1
                              if forloop.index > max
                                if is_count
                                  echo enable_count
                                endif
                                break
                              endif
                            %}
                          {% endif %}
                        {% elsif settings.swatches_type == 'text' or settings.swatches_type == 'both_text_and_color' and settings.text_option_name contains option.name %}
                          {% liquid
                            assign text_custom = blank
                            assign text_value = ''
                            for text_option_value in text_option_values
                              assign option_key = text_option_value | split: ':' | first
                              assign option_value = text_option_value | split: ':' | last
                              
                              if option_key == value
                                assign text_custom = option_key
                                assign text_value = option_value
                                break
                              endif
                            endfor
                          %}
    
                          <label class="flex items-center outline-none font-medium text-[13px] cursor-pointer{% if settings.info_alignment_card_product == 'right' %} rtl:mr-0{% endif %} pl-3.5 pr-3.5 pt-1.5 pb-1.5 border bg-[rgba(var(--background-color),1)]
                            {% if settings.edges_type == 'rounded_corners' %} rounded-md{% endif %}" 
                            for="{{ section_id }}-{{ product_card_id }}-{{ option.position }}-{{ forloop.index0 }}-{{ card_product.id }}"
                          >
                            <span class="p-break-words">
                              {% if text_custom != blank %}{{ text_value | escape }}{% else %}{{ value | escape }}{% endif %}
                            </span>
                          </label>
                        {% endif %}
                      {%- endfor -%}
                    </div>
                  </fieldset>
                {% elsif settings.swatches_type == 'both_text_and_color' %}
                  {%- assign option_index = forloop.index | minus: 1 -%}
                  <fieldset
                    id="Option-{{ section_id }}-{{ product_card_id }}-{{ forloop.index0 }}"
                    class="product-form__input pl-0{% unless forloop.last %} pb-2{% endunless %} quick-view:pb-2 eurus gap-x-2 hidden"
                    x-init="options[{{ forloop.index | minus: 1 }}] = document.querySelector('#Option-{{ section_id }}-{{ product_card_id }}-{{ forloop.index0 }} input[checked]').value"
                  >
                    <div class="inline-flex flex-wrap justify-left">
                      {%- for value in option.values -%}
                        
                        {% if forloop.first %}
                          <input 
                            id="{{ section_id }}-{{ product_card_id }}-{{ option.position }}-{{ forloop.index0 }}-{{ card_product.id }}"
                            section-id="{{ section_id }}-{{ product_card_id }}"
                            option-pos="{{ option.position }}"
                            forloop="{{ forloop.index0 }}"
                            type="radio"
                            name="{{ option.name }}-{{ product_card_id }}-{{ section_id }}"
                            value="{{ value | escape | replace: '&lt;', '\u003c' | replace: '&gt;', '\u003e' }}"
                            form="{{ product_form_id }}"
                            class="absolute opacity-0 h-1 w-1 input-radio"
                            {% if option_index > 0 %}:class="{'disabled': !currentAvailableOptions[{{ option_index }}] || !currentAvailableOptions[{{ option_index }}].includes(`{{ value | escape }}`)}"{% endif %}
                            x-model="options[{{ option_index }}]"
                            aria-label="{{ value | escape }}"
                            checked
                          >  
                          <label class="flex items-center outline-none font-medium text-[13px] cursor-pointer mr-[5px]{% if settings.info_alignment_card_product == 'right' %} rtl:mr-0 rtl:ml-1.5{% endif %} pl-3.5 pr-3.5 pt-1.5 pb-1.5 border bg-[rgba(var(--background-color),1)]
                            {% if rounded_corner %} rounded-md{% endif %}" for="{{ section_id }}-{{ product_card_id }}-{{ option.position }}-{{ forloop.index0 }}-{{ card_product.id }}"
                          >
                            <span class="p-break-words">{{ value | escape }}</span>
                          </label>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </fieldset>
                {% endif %}
              {%- endfor -%}
            </div>
          </div>
        {% else %}
          <div @init-run="document.addEventListener('eurus:cart:items-changed', () => {
            Alpine.store('xUpdateVariantQuanity').updateQuantity('{{ section.id }}', '{{ card_product.url }}');
          });"></div>
          <div
            id="current-variant-{{ section_id }}-{{ card_product.id }}-{{ block_id }}" 
            class="current-variant hidden"
          >
            {{ card_product.selected_or_first_available_variant.id }}
          </div>
        {% endunless %}
      {% else %}
        <div @init-run="document.addEventListener('eurus:cart:items-changed', () => {
          Alpine.store('xUpdateVariantQuanity').updateQuantity('{{ section.id }}', '{{ card_product.url }}');
        });"></div>
        <div
          id="current-variant-{{ section_id }}-{{ card_product.id }}-{{ block_id }}" 
          class="current-variant hidden"
        >
          {{ card_product.selected_or_first_available_variant.id }}
        </div>
      {%- endif -%}
    {% endunless %}
    {% if list_layout and show_description %}
      {% if card_product.description != blank %}
        <div class="hidden md:list-layout:block mt-5{% if is_rtl %} md:list-layout:text-right{% else %} md:list-layout:text-left{% endif %}">
          <div class="rte line-clamp-3">
            {{ card_product.description | replace: '<img', '<noimg' | replace: '</img>', '</noimg>' | replace: '<iframe', '<noiframe' | replace: '</iframe>', '</noiframe>' | replace: 'src=', 'nosrc=' | replace: '<h1', '<p class="h2"' | replace: '<h2', '<p class="h2"' | replace: '<h3', '<p class="h3"' | replace: '<h4', '<p class="h4"' | replace: '<h5', '<p class="h5"' | replace: '<h6', '<p class="h6"' }}
          </div>
        </div>
      {% endif %}
    {% endif %}
    <div class="bottom-card card-info ltr flex flex-wrap justify-{{ content_alignment }} gap-1 empty:hidden"></div>
    {% unless disable_quickview %}
      <template x-if="$store.xQuickView">
        {%- unless settings.hide_cart -%} 
          <div x-data="xProductCart" x-show="$store.xQuickView.show_atc_button && ($store.xQuickView.btn_atc_bottom || !$store.xQuickView.atc_btn_image_desktop)" 
            class="card-info bottom_atc md:list-layout:hidden {% if show_icon_atc %}hide-btn{% else %}hide-icon{% endif %}"
            :class="if($store.xQuickView.show_atc_button){ return ($store.xQuickView.btn_atc_bottom ? '' : 'hidden') + ($store.xQuickView.atc_btn_image_desktop ? ' lg:hidden' : ' lg:block')}"
            x-cloak
          >
            {% if card_product.options_with_values.size == swatch_count or card_product.has_only_default_variant %}
              {%- assign product_form_id = 'product-form-choose-option' | append: card_product.id | append: index_param -%}
              {%- form 'product', card_product, id: product_form_id, class: 'form h-full', novalidate: 'novalidate', data-type: 'add-to-cart-form', x-ref: 'product_form' -%}
                <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}">
                {% if settings.show_in_cart_items != 'none' %}
                  {% render 'estimate-shipping-cart', product: card_product, message: settings.message_estimate_cart, disable_cart_edt: disable_cart_edt %}
                {% endif %}
                {% if can_show_preorder %}
                  <input name="properties[{{ 'general.preorder.name' | t }}]" class="hidden" value="{{ message_preorder }}"/>
                {% endif %}                                            
                <button
                  type="submit"
                  name="add"
                  {%- if card_product.has_only_default_variant or card_product.selected_or_first_available_variant.available == false -%}
                    @click.prevent="errorMessage == false && addToCart($event)"
                  {%- else -%}
                    {% if settings.products_color_swatches_enable_on_collection_page %}
                      @click.prevent="errorMessage == false && addToCart($event)"
                    {% else %}
                      @click.prevent="setTimeout(() => { $store.xQuickView && (showOptions = !showOptions); $store.xQuickView.showChooseOption('{{ section_id }}-{{ card_product.id }}-{{ block_id }}', $el); }, 0)"
                      x-on:mouseover="setTimeout(() => { $store.xQuickView && $store.xQuickView.loadChooseOptions('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}', {{ index_param }}); }, 0)"
                    {% endif %}
                  {%- endif -%}
                  data-id="{{ section_id }}-{{ card_product.id }}-{{ block_id }}"
                  class="button button--quickview button-solid not-icon leading-normal mt-2 w-full pr-5 pl-5 py-2.5 lg:py-3 h-full z-[15] text-[12px] lg:text-[14px] lg:-translate-x-0 disabled:cursor-not-allowed disabled:opacity-60"
                  {% if settings.enable_shipping_insurance and settings.shipping_insurance_added_by_default and shipping_insurance %}
                    x-init="loadInsurance('{{ shipping_insurance }}')"
                  {% endif %}
                  {% if settings.enable_shipping_insurance and settings.product_shipping_insurance != blank and settings.product_shipping_insurance.id == card_product.id %}
                    style="display: none;"
                  {% endif %}
                  :class="errorMessage && 'opacity-60 cursor-not-allowed'"
                  {% if card_product.selected_or_first_available_variant.available == false %}
                    disabled
                    aria-label="{{ 'products.product.sold_out' | t }}"
                  {% else %}
                    {%- if card_product.has_only_default_variant -%}
                      aria-label="{{ 'products.product.add_to_cart' | t }}"
                    {% else %}
                      {% if settings.products_color_swatches_enable_on_collection_page %}
                        aria-label="{{ 'products.product.add_to_cart' | t }}"
                      {% else %}
                        aria-label="{{ 'products.product.choose_options' | t }}"
                      {% endif %}
                    {% endif %}
                  {% endif %}
                >
                  <span :class="{ 'lg:block opacity-0 is-focus-button' : loading, 'hidden' : errorMessage}">
                    {%- if card_product.selected_or_first_available_variant.available -%}
                      {%- if card_product.has_only_default_variant -%}
                        {% liquid
                          if can_show_preorder
                            assign button_label = 'products.product.pre_order' | t
                            if settings.card_button_preorder != blank
                              assign button_label = settings.card_button_preorder
                            endif
                          else 
                            assign button_label = 'products.product.add_to_cart' | t
                          endif
                        %}
                        <span class="flex items-center justify-center">
                          {% render 'button-label', button_label: button_label, show_button_style: 'primary' %}
                        </span>
                      {%- else -%}
                        {% liquid
                          if settings.products_color_swatches_enable_on_collection_page
                            if can_show_preorder
                              assign button_label = 'products.product.pre_order' | t
                              if settings.card_button_preorder != blank
                                assign button_label = settings.card_button_preorder
                              endif
                            else 
                              assign button_label = 'products.product.add_to_cart' | t
                            endif
                          else
                            assign button_label = 'products.product.choose_options' | t
                          endif
                        %}
                        <span class="flex items-center justify-center">
                          {% render 'button-label', button_label: button_label, show_button_style: 'primary' %}
                        </span>
                      {%- endif -%}
                    {%- else -%}
                      {{ 'products.product.sold_out' | t }}
                    {%- endif -%}
                  </span>
                  <div
                    class="flex gap-x-2 items-center justify-center"
                    role="alert"
                    x-cloak
                    x-show="errorMessage"
                  >
                    {{ 'products.product.sold_out' | t }}
                  </div>
                  <div class="lg:inline-block animate-spin w-4 h-4 md:w-5 md:h-5 absolute top-[calc(50%-8px)] left-[calc(50%-8px)] md:top-[calc(50%-10px)] md:left-[calc(50%-10px)]" x-show="loading" x-cloak>
                    {% render 'icon-alls', icon: 'icon-loading' %}
                  </div>
                </button>
              {%- endform -%}
            {% else %}
              <button
                type="submit"
                name="add"
                
                @click.prevent="setTimeout(() => { $store.xQuickView && (showOptions = !showOptions); $store.xQuickView.showChooseOption('{{ section_id }}-{{ card_product.id }}-{{ block_id }}', $el); }, 0)"
                x-on:mouseover="setTimeout(() => { $store.xQuickView && $store.xQuickView.loadChooseOptions('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}', {{ index_param }}); }, 0)" 
                data-id="{{ section_id }}-{{ card_product.id }}-{{ block_id }}"
                class="button button--quickview button-solid not-icon leading-normal mt-2 w-full pr-5 pl-5 py-2.5 lg:py-3 h-full text-[12px] lg:text-[14px] lg:-translate-x-0 disabled:cursor-not-allowed disabled:opacity-60"
                :class="errorMessage && 'opacity-60 cursor-not-allowed'"
                aria-label="{{ 'products.product.choose_options' | t }}"
              >
                <span :class="{ 'lg:block opacity-0 is-focus-button' : loading, 'hidden' : errorMessage}">
                  {% assign button_label = 'products.product.choose_options' | t %}
                  <span class="flex items-center justify-center">
                    {% render 'button-label', button_label: button_label, show_button_style: 'primary' %}
                  </span>
                </span>
                <div class="lg:inline-block animate-spin w-4 h-4 md:w-5 md:h-5 absolute top-[calc(50%-8px)] left-[calc(50%-8px)] md:top-[calc(50%-10px)] md:left-[calc(50%-10px)]" x-show="loading" x-cloak>
                  {% render 'icon-alls', icon: 'icon-loading' %}
                </div>
              </button>
            {% endif %} 
          </div>
        {%- endunless -%} 
      </template>
    {% endunless %}
    {% unless disable_quickview %}
      <template x-if="$store.xQuickView">
        <div class="hidden md:list-layout:flex gap-3 mt-5 md:mt-7" x-show="$store.xQuickView">
          {%- unless settings.hide_cart -%} 
            <div x-data="xProductCart" x-show="$store.xQuickView.show_atc_button" :class="$store.xQuickView.show_atc_button && ''">
              {% if card_product.options_with_values.size == swatch_count or card_product.has_only_default_variant %}
                {%- assign product_form_id = 'product-form-choose-option' | append: card_product.id | append: index_param -%}
                {%- form 'product', card_product, id: product_form_id, class: 'form h-full', novalidate: 'novalidate', data-type: 'add-to-cart-form', x-ref: 'product_form' -%}
                  <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}">
                  {% if settings.show_in_cart_items != 'none' %}
                    {% render 'estimate-shipping-cart', product: card_product, message: settings.message_estimate_cart, disable_cart_edt: disable_cart_edt %}
                  {% endif %}
                  {% if can_show_preorder %}
                    <input name="properties[{{ 'general.preorder.name' | t }}]" class="hidden" value="{{ message_preorder }}"/>
                  {% endif %}                                            
                  <button
                    type="submit"
                    name="add"
                    {%- if card_product.has_only_default_variant or card_product.selected_or_first_available_variant.available == false -%}
                      @click.prevent="errorMessage == false && addToCart($event)"
                    {%- else -%}
                      {% if settings.products_color_swatches_enable_on_collection_page %}
                        @click.prevent="errorMessage == false && addToCart($event)"
                      {% else %}
                        @click.prevent="setTimeout(() => { $store.xQuickView && (showOptions = !showOptions); $store.xQuickView.showChooseOption('{{ section_id }}-{{ card_product.id }}-{{ block_id }}', $el); }, 0)"
                        x-on:mouseover="setTimeout(() => { $store.xQuickView && $store.xQuickView.loadChooseOptions('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}', {{ index_param }}); }, 0)" 
                      {% endif %}
                    {%- endif -%}
                    data-id="{{ section_id }}-{{ card_product.id }}-{{ block_id }}"
                    class="button button--quickview button-solid not-icon leading-normal w-full py-2.5 pl-5 pr-5 lg:py-3 h-full z-50 text-[12px] lg:text-[14px] lg:-translate-x-0 disabled:cursor-not-allowed disabled:opacity-60 hidden{% if show_icon_atc %} xl:block{% else %} lg:block{% endif %}"
                    {% if settings.enable_shipping_insurance and settings.shipping_insurance_added_by_default and shipping_insurance %}
                      x-init="loadInsurance('{{ shipping_insurance }}')"
                    {% endif %}
                    {% if settings.enable_shipping_insurance and settings.product_shipping_insurance != blank and settings.product_shipping_insurance.id == card_product.id %}
                      style="display: none;"
                    {% endif %}
                    :class="errorMessage && 'opacity-60 cursor-not-allowed'"
                    {% if card_product.selected_or_first_available_variant.available == false %}
                      disabled
                      aria-label="{{ 'products.product.sold_out' | t }}"
                    {% else %}
                      {%- if card_product.has_only_default_variant -%}
                        aria-label="{{ 'products.product.add_to_cart' | t }}"
                      {% else %}
                        {% if settings.products_color_swatches_enable_on_collection_page %}
                          aria-label="{{ 'products.product.add_to_cart' | t }}"
                        {% else %}
                          aria-label="{{ 'products.product.choose_options' | t }}"
                        {% endif %}
                      {% endif %}
                    {% endif %}
                  >
                    <span :class="{ 'lg:block opacity-0 is-focus-button' : loading, 'hidden' : errorMessage}">
                      {%- if card_product.selected_or_first_available_variant.available -%}
                        {%- if card_product.has_only_default_variant -%}
                          {% liquid
                            if can_show_preorder
                              assign button_label = 'products.product.pre_order' | t
                              if settings.card_button_preorder != blank
                                assign button_label = settings.card_button_preorder
                              endif
                            else 
                              assign button_label = 'products.product.add_to_cart' | t
                            endif
                          %}
                          <span class="flex items-center justify-center">
                            {% render 'button-label', button_label: button_label, show_button_style: 'primary' %}
                          </span>
                        {%- else -%}
                          {% liquid
                            if settings.products_color_swatches_enable_on_collection_page
                              if can_show_preorder
                                assign button_label = 'products.product.pre_order' | t
                                if settings.card_button_preorder != blank
                                  assign button_label = settings.card_button_preorder
                                endif
                              else 
                                assign button_label = 'products.product.add_to_cart' | t
                              endif
                            else
                              assign button_label = 'products.product.choose_options' | t
                            endif
                          %}
                          <span class="flex items-center justify-center">
                            {% render 'button-label', button_label: button_label, show_button_style: 'primary' %}
                          </span>
                        {%- endif -%}
                      {%- else -%}
                        {{ 'products.product.sold_out' | t }}
                      {%- endif -%}
                    </span>
                    <div
                      class="flex gap-x-2 items-center justify-center"
                      role="alert"
                      x-cloak
                      x-show="errorMessage"
                    >
                      {{ 'products.product.sold_out' | t }}
                    </div>
                    <div class="lg:inline-block animate-spin w-4 h-4 md:w-5 md:h-5 absolute top-[calc(50%-8px)] left-[calc(50%-8px)] md:top-[calc(50%-10px)] md:left-[calc(50%-10px)]" x-show="loading" x-cloak>
                      {% render 'icon-alls', icon: 'icon-loading' %}
                    </div>
                  </button>
                  {%- assign swatch_count = 0 -%}
                  {%- for option in card_product.options_with_values -%}
                    {% liquid
                      assign show_swatch = false
                      assign show_color_swatch = false
                      assign show_text_swatch = false
                      if settings.text_option_name contains option.name and settings.swatches_type == 'text'
                        assign show_text_swatch = true
                      endif
                      if settings.color_option_name contains option.name and settings.swatches_type == 'color'
                        assign show_color_swatch = true
                      endif
                      if settings.swatches_type == 'both_text_and_color'
                        if settings.text_option_name contains option.name or settings.color_option_name contains option.name
                          assign show_swatch = true
                        endif
                      endif
                    %}
                    {% if show_swatch or show_text_swatch or show_color_swatch %}
                      {%- assign swatch_count = swatch_count | plus: 1 -%}
                    {% endif %}
                  {%- endfor -%}
                  <button 
                    type="submit"
                    name="add"
                    {%- if card_product.has_only_default_variant or card_product.selected_or_first_available_variant.available == false -%}
                      @click.prevent="errorMessage == false && addToCart($event)"
                    {%- else -%}
                      {% if settings.products_color_swatches_enable_on_collection_page %}
                        @click.prevent="errorMessage == false && addToCart($event)"
                      {% else %}
                        @click.prevent="setTimeout(() => { $store.xQuickView && (showOptions = !showOptions); $store.xQuickView.showChooseOption('{{ section_id }}-{{ card_product.id }}-{{ block_id }}', $el); }, 0)"
                        x-on:mouseover="setTimeout(() => { $store.xQuickView && $store.xQuickView.loadChooseOptions('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}', {{ index_param }}); }, 0)" 
                      {% endif %}
                    {%- endif -%}
                    class="button label-btn-quickview button-disable-effect not-icon button--quickview rounded-full lg:leading-snug none_border{% if show_icon_atc %} xl:hidden{% else %} lg:hidden{% endif %} h-full p-[6px] disabled:cursor-not-allowed disabled:opacity-60"
                    {% if settings.enable_shipping_insurance and settings.shipping_insurance_added_by_default and shipping_insurance %}
                      x-init="loadInsurance('{{ shipping_insurance }}')"
                    {% endif %}
                    {% if settings.enable_shipping_insurance and settings.product_shipping_insurance != blank and settings.product_shipping_insurance.id == card_product.id %}
                      style="display: none;"
                    {% endif %}
                    data-id="{{ section_id }}-{{ card_product.id }}-{{ block_id }}"
                    :class="errorMessage && 'opacity-60 cursor-not-allowed'"
                    {% if card_product.selected_or_first_available_variant.available == false %}
                      disabled
                      aria-label="{{ 'products.product.sold_out' | t }}"
                    {% else %}
                      {%- if card_product.has_only_default_variant -%}
                        aria-label="{{ 'products.product.add_to_cart' | t }}"
                      {% else %}
                        {% if settings.products_color_swatches_enable_on_collection_page %}
                          aria-label="{{ 'products.product.add_to_cart' | t }}"
                        {% else %}
                          aria-label="{{ 'products.product.choose_options' | t }}"
                        {% endif %}
                      {% endif %}
                    {% endif %}
                    x-customer-event-data="{{ data_for_customer_event | escape }}"
                  >
                    <span class="w-5 h-5 flex items-center justify-center md:w-6 md:h-6" x-show="!loading">{%- render 'icon-cart-all', icon: 'icon-cart-quick-add' -%}</span>
                    <span class="block w-5 h-5 animate-spin" x-show="loading" x-cloak>
                    {% render 'icon-alls', icon: 'icon-loading' %}
                  </span>
                </button>
                {%- endform -%}
              {% else %}
                <button
                  type="submit"
                  name="add"
                  
                  @click.prevent="setTimeout(() => { $store.xQuickView && (showOptions = !showOptions); $store.xQuickView.showChooseOption('{{ section_id }}-{{ card_product.id }}-{{ block_id }}', $el); }, 0)"
                  x-on:mouseover="setTimeout(() => { $store.xQuickView && $store.xQuickView.loadChooseOptions('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}', {{ index_param }}); }, 0)" 
                  data-id="{{ section_id }}-{{ card_product.id }}-{{ block_id }}"
                  class="button button--quickview button-solid not-icon leading-normal w-full py-2.5 lg:pl-5 lg:pr-5 lg:py-3 h-full text-[12px] lg:text-[14px] lg:-translate-x-0 disabled:cursor-not-allowed disabled:opacity-60 hidden{% if show_icon_atc %} xl:block{% else %} lg:block{% endif %}"
                  :class="errorMessage && 'opacity-60 cursor-not-allowed'"
                  aria-label="{{ 'products.product.choose_options' | t }}"
                >
                  <span :class="{ 'lg:block opacity-0 is-focus-button' : loading, 'hidden' : errorMessage}">
                    {% assign button_label = 'products.product.choose_options' | t %}
                    <span class="flex items-center justify-center">
                      {% render 'button-label', button_label: button_label, show_button_style: 'primary' %}
                    </span>
                  </span>
                  <div class="lg:inline-block animate-spin w-4 h-4 md:w-5 md:h-5 absolute top-[calc(50%-8px)] left-[calc(50%-8px)] md:top-[calc(50%-10px)] md:left-[calc(50%-10px)]" x-show="loading" x-cloak>
                    {% render 'icon-alls', icon: 'icon-loading' %}
                  </div>
                </button>
              {% endif %} 
            </div>
          {%- endunless -%} 
          <button 
            x-on:mouseover="$store.xQuickView && $store.xQuickView.load('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}')" 
            x-on:focus="$store.xQuickView && $store.xQuickView.load('{{ card_product.url | within: collection | split: "?" | first }}', $el, '{{ section_id }}-{{ card_product.id }}-{{ block_id }}')" 
            @click.prevent='$store.xQuickView && $store.xQuickView.load("{{ card_product.url | within: collection | split: "?" | first }}", $el, "{{ section_id }}-{{ card_product.id }}-{{ block_id }}") && $store.xQuickView.open(); $store.xCustomerEvent.fire("product_selected", $el);' 
            class="button label-btn-quickview button-solid button--quickview leading-normal none_border pt-2 pl-5 pb-2 pr-5 lg:pt-3 lg:pb-3" 
            aria-label="{{ 'products.product.button_quickview' | t }}"
            x-customer-event-data="{{ data_for_customer_event | escape }}"
            x-show="$store.xQuickView.enabled"
          >
            <span class="flex justify-center items-center">
              {% render 'button-label', x_text_quickview: true, show_button_style: 'primary' %}
            </span>
          </button>
        </div>
      </template>
    {% endunless %}
  </div>
</div>