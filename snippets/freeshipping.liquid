{% comment %}
  Renders freeshipping bar
{% endcomment %}
{%- if settings.enable_free_shipping -%}
  {% liquid
    assign cart_total = cart.total_price | divided_by: 100.00

    assign freeshipping_thresholds = settings.order_amount_freeshipping | newline_to_br | strip_newlines | split: '<br />'
    if settings.order_amount_freeshipping contains ';'
      assign freeshipping_thresholds = settings.order_amount_freeshipping | remove: " " | split: ';'
    endif
    
    for threshold in freeshipping_thresholds
      unless threshold contains ':' 
        if threshold != blank 
          assign check_currency = threshold | remove: "0" | remove: "1" | remove: "2" | remove: "3" | remove: "4" | remove: "5" | remove: "6" | remove: "7" | remove : "8" | remove: "9" | remove: ":" | remove: " "
          if check_currency == '' or check_currency == '.'
            assign freeshipping_threshold_all = threshold | strip | plus: 0
          endif
        endif
      else 
        assign check_currency_first = threshold | split: ":" | first 
        assign check_currency_last = threshold | split: ":" | last 
        assign check_currency = threshold | remove_first: check_currency_first | remove: check_currency_last
        if check_currency == ':'
          if check_currency_first == cart.currency.iso_code
            assign freeshipping_threshold_currency = check_currency_last | strip | plus: 0
          endif 
        else
          assign check_currency_country = check_currency | remove: ":"
          if check_currency_first == localization.country.iso_code and check_currency_country == cart.currency.iso_code
            assign freeshipping_threshold_country = check_currency_last | strip | plus: 0
          endif
        endif 
      endunless
    endfor
    if freeshipping_threshold_all
      assign freeshipping_threshold = freeshipping_threshold_all
    endif 
    if freeshipping_threshold_currency
      assign freeshipping_threshold = freeshipping_threshold_currency
    endif 
    if freeshipping_threshold_country
      assign freeshipping_threshold = freeshipping_threshold_country
    endif 

    assign freegift_thresholds = settings.order_amount_freegift | newline_to_br | strip_newlines | split: '<br />'
    if settings.order_amount_freegift contains ';'
      assign freegift_thresholds = settings.order_amount_freegift | remove: " " | split: ';'
    endif

    for threshold in freegift_thresholds
      unless threshold contains ':' 
        if threshold != blank 
          assign check_currency = threshold | remove: "0" | remove: "1" | remove: "2" | remove: "3" | remove: "4" | remove: "5" | remove: "6" | remove: "7" | remove : "8" | remove: "9" | remove: ":" | remove: " "
          if check_currency == '' or check_currency == '.'
            assign freegift_threshold_all = threshold | strip | plus: 0
          endif
        endif
      else 
        assign check_currency_first = threshold | split: ":" | first 
        assign check_currency_last = threshold | split: ":" | last 
        assign check_currency = threshold | remove_first: check_currency_first | remove: check_currency_last
        if check_currency == ':'
          if check_currency_first == cart.currency.iso_code
            assign freegift_threshold_currency = check_currency_last | strip | plus: 0
          endif 
        else
          assign check_currency_country = check_currency | remove: ":"
          if check_currency_first == localization.country.iso_code and check_currency_country == cart.currency.iso_code
            assign freegift_threshold_country = check_currency_last | strip | plus: 0
          endif
        endif 
      endunless
    endfor
    if freegift_threshold_all
      assign freegift_threshold = freegift_threshold_all
    endif 
    if freegift_threshold_currency
      assign freegift_threshold = freegift_threshold_currency
    endif 
    if freegift_threshold_country
      assign freegift_threshold = freegift_threshold_country
    endif 
  %}
  {% if cart.item_count > 0 %}
    {% liquid
      if freeshipping_threshold or freegift_threshold
        assign amount_to_freeshipping = freeshipping_threshold | minus: cart_total
        assign amount_to_freegift = freegift_threshold | minus: cart_total
        assign underline_width = 0
        assign freeshipping_percent = cart_total | divided_by: freeshipping_threshold
        if freeshipping_percent < 1 and amount_to_freeshipping >= amount_to_freegift
          assign underline_width = freeshipping_percent | times: 100
        endif
        assign freegift_percent = cart_total | divided_by: freegift_threshold
        if freegift_percent < 1 and amount_to_freegift >= amount_to_freeshipping
          assign underline_width = freegift_percent | times: 100
        endif
      endif
    %}
    {% style %}
      .free-offer-bar {
        border-color: rgba(var(--colors-line-and-border), 0.5);
      }

      .free-offer-bar:after {
        background: rgba(var(--colors-line-and-border));
        transition: width 1s ease-in-out;
        width: 0;
      }

      .free-offer-bar.active:after {
        width: {{ underline_width }}%;
      }

      .free-offer-bar-success {
        border-color: rgba(var(--color-success), 0.5);
      }

      .free-offer-bar-success:after {
        background: rgba(var(--color-success));
        transition: width 1s ease-in-out;
        width: 0;
      }

      .free-offer-bar-success.active:after {
        width: 100%;
      }
    {% endstyle %}
    <div x-data="{active: false}" x-intersect:enter="active = true" x-intersect:leave="active = false">
      <div class="{% if main_cart %}mb-8{% else %}mb-4{% endif %}">
        {% if amount_to_freeshipping > 0 or amount_to_freegift > 0 %}
          {% if settings.order_amount_freeshipping != blank %}
            {% if amount_to_freeshipping > 0 %}
              {% assign amount_to_freeshipping = amount_to_freeshipping | times: 100 | money %}
              <p class="pb-1.5">{{- 'general.cart.enable_amount_freeship_html' | t: amount_to_freeshipping: amount_to_freeshipping -}}</p>
            {% else %}
              <p class="pb-1.5">{{ 'general.cart.freeshipping' | t }}</p>
            {% endif %}
          {% endif %}
          {% if settings.order_amount_freegift != blank %}
            {% if amount_to_freegift > 0 %}
              {% assign amount_to_freegift = amount_to_freegift | times: 100 | money %}
              <p class="pb-1.5">{{- 'general.cart.enable_amount_freegift_html' | t: amount_to_freegift: amount_to_freegift, other_offer: settings.other_offer_name -}}</p>
            {% else %}
              <p class="pb-1.5">{{ 'general.cart.freegift' | t: other_offer: settings.other_offer_name }}</p>
            {% endif %}
          {% endif %}
          <div :class="active && 'active'" class="{% if main_cart %}lg:w-1/3 {% endif %}border-b-2 relative after:absolute after:left-0 after:-bottom-0.5 after:h-0.5 after:z-20 free-offer-bar"></div>
        {% else %}
          {% if amount_to_freeshipping <= 0 and amount_to_freegift <= 0 and settings.order_amount_freeshipping != blank and settings.order_amount_freegift != blank %}
            <p class="pb-1.5">{{ 'general.cart.free_all_offer' | t: other_offer: settings.other_offer_name }}</p>
          {% else %}
            {% if amount_to_freeshipping <= 0 and settings.order_amount_freeshipping != blank %}
              <p class="pb-1.5">{{ 'general.cart.freeshipping' | t }}</p>
            {% endif %}
            {% if amount_to_freegift <= 0 and settings.order_amount_freegift != blank %}
              <p class="pb-1.5">{{ 'general.cart.freegift' | t: other_offer: settings.other_offer_name }}</p>
            {% endif %}
          {% endif %}
          {% if settings.order_amount_freeshipping != blank or settings.order_amount_freegift != blank %}
            <div :class="active && 'active'" class="{% if main_cart %}lg:w-1/3 {% endif %}border-b-2 relative after:absolute after:left-0 after:-bottom-0.5 after:h-0.5 after:z-20 free-offer-bar-success"></div>
          {% endif %}
        {% endif %}
      </div>
    </div>
  {% endif %}
{%- endif -%}